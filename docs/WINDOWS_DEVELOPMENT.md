# Подробное руководство по развёртыванию сервера Xiaozhi ESP32 на Windows

## Проверка системных требований
- Убедитесь, что ваша система Windows соответствует требованиям:
  - Windows 10 или новее (рекомендуется последняя версия)
  - Права администратора

## 1. Установка Java JDK 21
1. Скачайте JDK 21 с сайта Oracle: [Oracle JDK 21](https://www.oracle.com/java/technologies/downloads/#java21)  
2. Запустите установщик и следуйте мастеру
3. Настройте переменные окружения:
   - ПКМ по «Этот компьютер» → Свойства → Дополнительные параметры системы → Переменные среды
   - В «Системные переменные» создайте:
     - Имя: `JAVA_HOME`
     - Значение: `C:\Program Files\Java\jdk-21.0.7` (путь зависит от установленной версии)
   - Отредактируйте «Path», добавьте: `%JAVA_HOME%\bin`
4. Проверка установки:
   - Откройте Командную строку (Win+R → `cmd`)
   - Выполните: `java -version`
   - Должно отобразиться, например: `openjdk version "21.0.7"`

## 2. Установка MySQL
1. Скачайте инсталлятор MySQL Community: [MySQL](https://dev.mysql.com/downloads/installer/)
2. Запустите установку, режим «Custom»
3. Выберите к установке:
   - MySQL Server
   - MySQL Workbench (опционально, GUI)
4. В настройке:
   - Задайте пароль root (сложный)
   - Запомните пароль
5. После установки запустите службу MySQL
6. Настройка переменных
   - Найдите путь к MySQL, обычно: `C:\Program Files\MySQL\MySQL Server 8\bin`
   - Если не уверены, найдите `mysql.exe` через Проводник
7. Добавьте в переменные среды
   - ПКМ по «Этот компьютер» → Свойства → Дополнительные параметры системы → Переменные среды
   - В «Системные переменные» → Path → Изменить → Создать — вставьте путь к bin MySQL
   - Сохраните изменения
8. Проверка
   - Откройте CMD и выполните `mysql --version`
   - При успешной настройке увидите версию (например, `mysql  Ver 8.0.42`)

## 3. Установка Maven
1. Скачайте Maven: [Maven](https://maven.apache.org/download.cgi)
   - Выберите «Binary zip archive»
2. Распакуйте в `C:\Program Files\apache-maven-3.9.4` (версия может отличаться)
3. Переменные среды:
   - Создайте системную переменную:
     - Имя: `MAVEN_HOME`
     - Значение: `C:\Program Files\apache-maven-3.9.4`
   - В «Path» добавьте: `%MAVEN_HOME%\bin`
4. Проверка:
   - В CMD выполните: `mvn -v`
   - Должна отобразиться версия Maven

## 4. Установка Node.js и npm
1. Скачайте LTS версию Node.js: [Node.js](https://nodejs.org/)
2. Установите с настройками по умолчанию
3. Проверка:
   - В CMD выполните:
     - `node -v`
     - `npm -v`
   - Должны отображаться версии

## 5. Установка FFmpeg (обязательно)
1. Перейдите на сайт FFmpeg: [FFmpeg](https://ffmpeg.org/download.html)
2. Выберите «Windows builds from gyan.dev»
3. Скачайте полный архив (например, `ffmpeg-git-full.7z`)
4. Распакуйте в `C:\Program Files\ffmpeg` (либо другой путь)
5. Добавьте в «Path»: `C:\Program Files\ffmpeg\bin`
6. Проверка:
   - В CMD выполните: `ffmpeg -version`
   - Должна отобразиться версия FFmpeg

## 6. Настройка базы данных (Windows)
1. Откройте Командную строку
2. Войдите в MySQL (пароль root, заданный при установке):
   ```bash
   mysql -u root -p
   ```
3. Создайте базу данных:
   ```sql
   CREATE DATABASE xiaozhi;
   ```
4. Создайте пользователя и выдайте права:
   ```sql
   CREATE USER 'xiaozhi'@'localhost' IDENTIFIED BY '123456';
   GRANT ALL PRIVILEGES ON xiaozhi.* TO 'xiaozhi'@'localhost';
   FLUSH PRIVILEGES;
   ```
5. Инициализируйте базу:
   - Убедитесь, что проект уже клонирован
   - В CMD перейдите в папку `db` в корне проекта
   - Выполните:
     ```bash
     mysql -u root -p xiaozhi < init.sql
     ```

## 7. Установка модели распознавания Vosk (Windows)
1. Скачайте китайскую модель: [Vosk Models](https://alphacephei.com/vosk/models)
   - Выберите `vosk-model-cn-0.22` (или последнюю китайскую модель)
2. Распакуйте zip‑архив
3. В корне проекта создайте папку `models` (если её нет)
4. Переименуйте распакованную папку модели в `vosk-model` и поместите в `models`
5. Итоговый путь должен быть: `папка_проекта\models\vosk-model`

## Развёртывание бэкенда (Windows)
1. Клонируйте репозиторий (если ещё не):
   ```bash
   git clone https://github.com/joey-zhou/xiaozhi-esp32-server-java
   ```
2. Перейдите в папку проекта:
   ```bash
   cd xiaozhi-esp32-server-java
   ```
3. Соберите проект Maven:
   ```bash
   mvn clean package -DskipTests
   ```
4. Запустите бэкенд:
   ```bash
   java -jar target\xiaozhi.server-*.jar（版本号可能不同）
   ```

## Развёртывание фронтенда (Windows)
1. Откройте новое окно CMD
2. Перейдите в каталог фронтенда:
   ```bash
   cd xiaozhi-esp32-server-java\web
   ```
3. Установите зависимости:
   ```bash
   npm install
   ```
4. Запустите dev‑сервер:
   ```bash
   npm run dev
   ```

## Доступ к системе
1. Убедитесь, что бэкенд запущен
2. Убедитесь, что фронтенд dev‑сервер запущен
3. Откройте в браузере: [http://localhost:8084](http://localhost:8084)
4. Войдите под учётными данными по умолчанию:
   - Логин: `admin`
   - Пароль: `123456`

## Частые проблемы в Windows
1. Конфликт портов:
   - Если порт 8084 занят:
     - Отредактируйте `src\main\resources\application.properties` и измените `server.port`
     - Во фронтенде (папка `web`) отредактируйте конфиг API
2. FFmpeg не найден:
   - Убедитесь, что путь FFmpeg добавлен в PATH
   - Перезапустите окно CMD и повторите
3. Проблемы с подключением MySQL:
   - Убедитесь, что служба MySQL запущена (проверьте в «Службах»)
   - Проверьте настройки БД в `application.properties`
4. Недостающие зависимости:
   - Если сборка падает, попробуйте:
     ```bash
     mvn clean install
     ```
   - Убедитесь, что сеть доступна и есть доступ к центральному репозиторию Maven
